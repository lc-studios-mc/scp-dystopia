{
	"format_version": "1.21.90",
	"minecraft:entity": {
		"description": {
			"identifier": "lc:scpdy_dropped_m17",
			"is_spawnable": false,
			"is_summonable": true,
			"is_experimental": false,
			"properties": {
				"lc:is_from_mob": {
					"type": "bool",
					"default": false
				},
				"lc:should_despawn": {
					"type": "bool",
					"default": false
				},
				"lc:is_available": {
					"type": "bool",
					"default": true
				}
			}
		},

		"components": {
			"minecraft:knockback_resistance": {
				"value": 1.0
			},
			"minecraft:type_family": {
				"family": ["inanimate", "dropped_weapon_pickable", "m17"]
			},
			"minecraft:health": {
				"value": 6,
				"max": 6
			},
			"minecraft:damage_sensor": {
				"triggers": [
					{
						"cause": "all",
						"deals_damage": "no"
					}
				]
			},
			"minecraft:breathable": {
				"breathes_water": true,
				"generates_bubbles": false
			},
			"minecraft:interact": {
				"interactions": [
					{
						"on_interact": {
							"filters": {
								"all_of": [
									{ "test": "bool_property", "domain": "lc:is_from_mob" },
									{ "test": "bool_property", "domain": "lc:is_available" },
									{ "test": "is_family", "subject": "other", "value": "player" },
									{ "test": "is_sneaking", "subject": "other", "value": false }
								]
							},
							"event": "lc:drop_ammo_and_despawn",
							"target": "self"
						},
						"cooldown": 0.1,
						"swing": true
					},
					{
						"on_interact": {
							"filters": {
								"all_of": [
									{ "test": "bool_property", "domain": "lc:is_from_mob", "value": false },
									{ "test": "bool_property", "domain": "lc:is_available" },
									{ "test": "is_family", "subject": "other", "value": "player" },
									{ "test": "is_sneaking", "subject": "other", "value": false }
								]
							},
							"event": "despawn",
							"target": "self"
						},
						"cooldown": 0.1,
						"swing": true,
						"spawn_items": { "table": "loot_tables/scpdy/guns/m17_single.json" }
					}
				]
			},
			"minecraft:physics": {
				"has_collision": true,
				"has_gravity": true
			},
			"minecraft:pushable": {
				"is_pushable": true,
				"is_pushable_by_piston": true
			},
			"minecraft:collision_box": {
				"width": 0.2,
				"height": 0.08
			},
			"minecraft:custom_hit_test": {
				"hitboxes": [
					{
						"width": 0.4,
						"height": 0.4,
						"pivot": [0, 0.15, 0]
					}
				]
			},
			"minecraft:is_stackable": {},
			"minecraft:nameable": {},
			"minecraft:body_rotation_blocked": {},
			"minecraft:conditional_bandwidth_optimization": {
				"default_values": {
					"max_dropped_ticks": 10,
					"max_optimized_distance": 40.0,
					"use_motion_prediction_hints": true
				}
			}
		},

		"component_groups": {
			"despawn_timer": {
				"minecraft:timer": {
					"looping": false,
					"randomInterval": true,
					"time": [60, 90],
					"time_down_event": {
						"event": "despawn"
					}
				}
			},

			"unavailability_timer": {
				"minecraft:timer": {
					"looping": false,
					"randomInterval": false,
					"time": 0.5,
					"time_down_event": {
						"event": "lc:on_unavailability_timer_complete"
					}
				}
			},

			"despawning": {
				"minecraft:transformation": {
					"into": "lc:scpdy_instant_despawn_dummy",
					"delay": { "value": 0.1 }
				}
			}
		},

		"events": {
			"lc:dropped_by_mob": {
				"add": { "component_groups": ["despawn_timer"] },
				"set_property": {
					"lc:is_from_mob": true,
					"lc:should_despawn": true
				}
			},

			"despawn": {
				"add": { "component_groups": ["despawning"] },
				"set_property": {
					"lc:is_available": false
				}
			},

			"lc:drop_ammo_and_despawn": {
				"trigger": "despawn",
				"queue_command": {
					"command": ["loot spawn ~ ~ ~ loot \"scpdy/ammo/few_9mm_ammo\""]
				}
			},

			"lc:request_pickup": {
				"sequence": [
					{
						"filters": {
							"test": "bool_property",
							"domain": "lc:is_available"
						},
						"add": { "component_groups": ["unavailability_timer"] },
						"remove": { "component_groups": ["despawn_timer"] },
						"set_property": {
							"lc:is_available": false
						},
						"queue_command": {
							"command": ["scriptevent scpdy_dropped_weapon:on_pickup_request"] // dropped_weapon.ts
						}
					}
				]
			},

			"lc:on_unavailability_timer_complete": {
				"sequence": [
					{
						"remove": { "component_groups": ["unavailability_timer"] },
						"set_property": {
							"lc:is_available": true
						}
					},
					{
						"filters": {
							"test": "bool_property",
							"domain": "lc:should_despawn"
						},
						"add": { "component_groups": ["despawn_timer"] }
					}
				]
			}
		}
	}
}
